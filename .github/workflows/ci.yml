# 1. Add the name of the workflow.
name: CI for Training and Evaluation

# 2. Set the trigger so that the workflow runs on a push or pull request
#    to the main branch or a manual run.
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  # Enables manual run from the GitHub Actions tab
  workflow_dispatch:

jobs:
  build-and-test:
    # 3. Build an environment for the job. We will load the latest Linux server.
    runs-on: ubuntu-latest

    steps:
      # 4. Activate the GitHub Actions that we are going to use in the workflow.
      - name: ⬇️ Checkout Repository
        uses: actions/checkout@v4

      # Setup Python environment (essential for training)
      - name: 🛠️ Setup Python 3.x
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
          cache: 'pip'

      # 5. Start adding different runs using various make commands.
      # Assuming you have a Makefile in your repo with these targets:
      
      - name: 💾 Install Dependencies (using make)
        run: make install

      - name: 🏃 Train Model (using make)
        run: make train

      - name: 📊 Evaluate Model (using make)
        run: make eval
        
      # Optional: Add a step to show the results in the log
      - name: 📝 Display Metrics
        run: cat Results/metrics.txt || echo "Metrics file not found."
